# Malware Playbook

## Scope
This playbook covers the end-to-end response process for malware-related incidents, including initial alert triage, investigation of file and process behavior, containment and remediation actions, and criteria for escalation or closure.

## 1. Preparation

<details open>
<summary>Expand/Collapse</summary>

| Category                          | Checklist Item                                                                                      | Status |
|----------------------------------|------------------------------------------------------------------------------------------------------|--------|
| **Asset Inventory**              | Maintain list of all company-owned domains                                                          | [ ]    |
|                                  | Maintain inventory of customers' assets, owners, and contacts                                       | [ ]    |
|                                  | Maintain inventory of company assets and administrators                                             | [ ]    |
|                                  | Track pre-authorized actions for all assets                                                         | [ ]    |
|                                  | Maintain type-based inventory: endpoints, servers, tools, network devices                           | [ ]    |
|                                  | Maintain list of network ranges (public, private, VPN, OOB)                                         | [ ]    |
|                                  | Maintain mapping of employees, partners, and clients                                                | [ ]    |
| **Email Security**               | Ensure anti-phishing, anti-malware, and quarantine features are enabled                             | [ ]    |
|                                  | Ensure users know how to report phishing                                                            | [ ]    |
| **Detection Engineering**        | Ensure detection for Office documents spawning: PowerShell, CMD, WMI, MSHTA                         | [ ]    |
|                                  | Perform alert testing after rule deployment                                                         | [ ]    |
|                                  | Conduct annual alert testing                                                                         | [ ]    |
| **Threat Intelligence**          | Review threats to the organization                                                                  | [ ]    |
|                                  | Review threats to the sector                                                                         | [ ]    |
|                                  | Identify common attack patterns                                                                      | [ ]    |
|                                  | Track new risks and vulnerabilities                                                                 | [ ]    |
| **Tooling & Documentation**      | Provide access to IR playbooks and workflows                                                        | [ ]    |
|                                  | Provide access to IR communication plan (severity levels, contact protocols)                        | [ ]    |
|                                  | Define and document IR roles and responsibilities                                                   | [ ]    |
|                                  | Ensure access to tool documentation and log field definitions                                       | [ ]    |
|                                  | Bookmark essential tools: VirusTotal, CyberChef                                                     | [ ]    |
| **External Communications**      | Create takedown templates for hosting providers                                                     | [ ]    |
|                                  | Create third-party phishing report templates                                                        | [ ]    |
|                                  | Validate customer/vendor contacts                                                                   | [ ]    |
|                                  | Validate internal escalation paths                                                                   | [ ]    |

[Download Checklist as Excel File](https://github.com/marthajsosa/Incident-Response-Playbooks/blob/main/IR%20Malware/Workflows/security_ops_checklist.xlsx)
</details>

## 2. Detect
<details open>
<summary>Expand/Collapse</summary>

### Workflow
<details open>
<summary>Expand/Collapse</summary>

![Malware Detection](https://github.com/marthajsosa/Incident-Response-Playbooks/blob/main/IR%20Malware/Workflows/Malware-Detection-Triage.drawio.png)

</details>

### Identify Threat Indicators
<details open>
<summary>Expand/Collapse</summary>


#### Automated Alert Sources

| Source                                     | Description                                                              |
|--------------------------------------------|---------------------------------------------------------------------------------|
| SIEM                                       | Central log aggregation and correlation engine for alerts                      |
| EDR (Endpoint Detection & Response)        | Detects process, memory, and behavioral anomalies on endpoints                 |
| Anti-Virus / Anti-Malware                  | Detects known malware signatures and heuristics                                |
| Web Proxy                                  | Detects unsafe browsing activity or C2 communication attempts                  |
| Email Security Gateway                     | Flags phishing, malware, spoofed sender domains                                |
| Cloud-Based Security (CASB, CSPM)          | Detects risky cloud behavior and policy violations                             |
| Firewall                                   | Alerts on blocked, anomalous, or high-volume traffic                           |
| VPN / Remote Access                        | Detects suspicious logins, locations, and session anomalies                    |
| Network IDS/IPS                            | Identifies known exploit traffic and anomalous packets                         |
| IAM / SSO System Alerts                    | Flags abnormal login patterns or abuse of elevated access                      |
| DLP (Data Loss Prevention)                 | Detects sensitive data leaving the network or being misused                    |
| File Integrity Monitoring (FIM)            | Detects unauthorized changes to critical system or config files                |
| Deception Systems / Honeypots              | Early detection of attacker lateral movement or scanning activity              |
| Threat Intelligence Platform               | Raises alerts on newly observed IOCs or TTP matches in logs                    |
| UEBA (User & Entity Behavior Analytics)    | Identifies deviations in normal user or host behavior                          |
| Analyst-Initiated / Manual Alerting        | Based on observations, hypotheses, or threat hunts                             |
| Dashboards / Monitoring Tools              | Real-time visibility into logs, processes, endpoints, etc.                     |

---

#### Human or External Notification Sources

| Source                                     | Description                                                                 |
|--------------------------------------------|---------------------------------------------------------------------------------|
| Internal Users                             | Often first to report suspicious emails, login prompts, or behavior            |
| Email Recipients (External)                | May receive phishing using spoofed brand identity                             |
| Third-Party Vendors / Partners             | Can alert about breaches or abuse involving shared systems                     |
| ISP or Hosting Providers                   | May report abuse or high traffic from company infrastructure                   |
| CERT or Law Enforcement                    | Coordinates on large-scale threats, takedowns, or known actor IOCs             |
| Security Researchers / Bug Bounty Reports  | Can report unpatched vulnerabilities or exposed assets                         |
| Social Media or Brand Monitoring Tools     | Detect impersonation, leaked credentials, or scams                            |
| Internal Application               | May observe logs, service crashes, or anomalies that security doesn’t see      |

</details>

## Data Collection

#### Gather Running Processes
<blockquote>Run in PowerShell</blockquote>

```powershell
Get-CimInstance Win32_Process | ForEach-Object {
    $p = $_
    $parent = Get-CimInstance Win32_Process -Filter "ProcessId = $($p.ParentProcessId)"
    $grandparent = if ($parent) { 
        Get-CimInstance Win32_Process -Filter "ProcessId = $($parent.ParentProcessId)" 
    } else { 
        $null 
    }
    
    [PSCustomObject]@{
        Name = $p.Name
        HandleCount = $p.HandleCount
        ProcessId = $p.ProcessId
        ParentProcessId = $p.ParentProcessId
        ParentName = if ($parent) { $parent.Name } else { $null }
        ParentCommandLine = if ($parent) { $parent.CommandLine } else { $null }
        GrandparentName = if ($grandparent) { $grandparent.Name } else { $null }
        GrandparentCommandLine = if ($grandparent) { $grandparent.CommandLine } else { $null }
        ExecutablePath = $p.ExecutablePath
        CommandLine = $p.CommandLine
        CreationDate = $p.CreationDate
    }
} | Export-Csv -Path "ProcessDetails.csv" -NoTypeInformation
```

#### Document
- Suspicious commandline
- Unusual parent/child process relationships
- Temp directories
- Unusual directories
- Executables with new, unrecognized, or random name
---
### Gather Network Connections
<blockquote>If you have access to the internet</blockquote>

```powershell
Get-NetTCPConnection -OwningProcess <PID> | Select-Object Local*, Remote*, State, OwningProcess
```

#### Document
- External IPs
- Beaconing/C2 behavior
- Unusual ports
---
### Gather Newly Written Files
<blockquote>Adjust timeframe</blockquote>

```powershell
Get-ChildItem "$env:TEMP" -Recurse | Where-Object { $_.LastWriteTime -gt (Get-Date).AddMinutes(-10) }
```

#### Document
- New executable files
- New DLLs
- New .tmp files
- Unrecognized, random, or suspicious file names or file paths
- Payload staging behavior
- Persistence artifacts
---
### Gather Memory Dump
<blockquote> If you have access to the internet. Run PowerShell as administrator.</blockquote>

- Download winpmem from https://github.com/Velocidex/WinPmem/releases
- cd to directory and run

```powershell
.\winpmem_mini_x64_rc2.exe <filename>.raw
```

#### Document
- Running processes from an unexpected location
- Ports that have all the same numbers such as ‘4444’ or increment such as ‘1234’
- [Check out this resource from SANS](https://sansorg.egnyte.com/dl/WFdH1hHnQI)
---
### Gather Loaded DLLs
<blockquote> </blockquote>

```powershell
# Create an output file
$outputFile = "C:\IR_Artifacts\LoadedDLLs.csv"
New-Item -ItemType Directory -Path "C:\IR_Artifacts" -Force | Out-Null

# Collect loaded DLLs for all running processes
Get-Process | ForEach-Object {
    $proc = $_
    try {
        $proc.Modules | ForEach-Object {
            [PSCustomObject]@{
                ProcessName = $proc.ProcessName
                ProcessId = $proc.Id
                DLLName = $_.ModuleName
                DLLPath = $_.FileName
            }
        }
    } catch {
        # Some system processes may not allow access to modules
        [PSCustomObject]@{
            ProcessName = $proc.ProcessName
            ProcessId = $proc.Id
            DLLName = "Access Denied"
            DLLPath = "Access Denied"
        }
    }
} | Export-Csv -Path $outputFile -NoTypeInformation

Write-Host "DLL collection complete. Output saved to $outputFile"
```
#### Document
- Suspicious DLL behaviors

| Artifact                                                    | Why It’s Suspicious                                                |
|-------------------------------------------------------------|---------------------------------------------------------------------|
| `OneDrive.exe` not in `C:\Program Files\OneDrive\`       | Likely copied to evade application control or logs                  |
| `crypt32.dll` next to it, not in `System32`                 | Likely sideloaded malware                                           |
| `crypt32.dll` is unsigned or unknown                        | Legit `crypt32.dll` is always signed by Microsoft                   |
| DLLs loaded from unexpected locations (e.g., AppData, Temp) | Malware often stores and loads payloads from user-writeable folders |
| Unmapped memory regions                                     | May indicate code injection or hollowing via reflective loading     |
| Suspicious processes with large numbers of DLLs or injected threads | May suggest injection, unpacking, or in-memory evasion techniques  |

- Hash the EXE and DLL – are they legit?
- Check the digital signature – use Get-AuthenticodeSignature
- Look at compile timestamps – DLL newer than EXE = highly suspicious
- Look for C2 connection with the process
---
## Compile Analysis

| Artifact                  | Significance in Analysis                                                        | What to Do with It                                                   |
|---------------------------|----------------------------------------------------------------------------------|-----------------------------------------------------------------------|
| **Hash**                  | Unique fingerprint of a file; helps identify reuse across campaigns             | Look up on VirusTotal, Hybrid Analysis, internal threat intel feeds   |
| **Reputation**            | Reflects known history (malicious, suspicious, clean)                           | Check EDR/AV verdicts, community tags, and threat intel platforms     |
| **Publisher/Author**      | Validates source; unknown or mismatched authors may indicate tampering          | Verify digital signatures with `Get-AuthenticodeSignature`           |
| **Behavior**              | Reveals what the file or domain does (e.g., downloads, injects, steals)         | Analyze in sandbox or memory, observe network/file/registry actions  |
| **Domains**               | Used for C2, phishing, payload delivery, tracking                               | Extract and check against DNS logs, blocklists, URL reputation tools |
| **Registrar**             | May hint at throwaway or abused services used by threat actors                  | Investigate WHOIS, registration date, privacy masking                 |
| **Owner**                 | Can tie infrastructure to known actor or service                                | Use WHOIS and hosting info to profile attacker                       |
| **IP**                    | Network pivot point; used to map attacker infra and behavior                    | Geolocate, run passive DNS, block or monitor                         |
| **Multistage / Redirect** | Indicates payload staging or evasion attempts                                   | Trace redirect chain in browser or sandbox                           |
| **IOCs on the site**      | Source of additional observables (e.g., hashes, URLs, scripts)                  | Scrape for secondary IOCs and generate detections                    |
| **Injecting malicious JS**| Sign of credential theft or browser exploitation                                | Deobfuscate scripts and look for exfil or phishing functionality     |
| **Custom Page (Phishing)**| Typically clones legit sites for stealing credentials                          | Capture screenshots, compare with real site, flag lookalike domains  |
| **Geolocation**           | Aids in attribution and policy-based risk assessment                            | Consider blocking, reporting, or tracking based on region            |
| **Other domains on IP**   | Suggests shared hosting, reuse, or infrastructure clustering                    | Use passive DNS or OSINT to identify related domains and threats     |

</details>

### Categorize
<details open>
<summary>Expand/Collapse</summary>

Determine type of malware
- Ransomware
- Credential Theft/InfoStealer
- Botnet/Remote Access
- Adware/PUP
- Dropper/Loader
- Fileless Malware

</details>

### Is it a Ransomware?
As time is VERY sensitive in the case of a Ransomware:  
- Follow communication protocol in Incident Response Plan
- Activate the entire SOC team
- Go to the Ransomware Workflow (coming soon).

### Is it an InfoStealer/Credential Harvester?
- Go to the Credential Theft/InfoStealer Workflow (coming soon).

### Is it Botnet/Remote Access activity?
- Go to the Botnet/Remote Access Workflow (coming soon).

### Is it Adware/PUP/Unapproved Software?
- Go to the Unapproved Software Workflow (coming soon).

### Is it a Loader/Dropper?
- Go to the Loader/Dropper Workflow (coming soon).

### Is it Fileless Malware?
- Go to the Fileless Malware Workflow (coming soon).
  
### Triage 
<details open>
<summary>Expand/Collapse</summary>

Determine
- Impact
    - Of destruction caused by malware
    - Lateral movement
    - Financial 
    - Disruption of services, workstations, operations
    - Data loss
    - Data exposure
- Scope: Number and list of hosts that
    - Have malicious files
        - Hash
        - File name
        - RegEx match (ie: INVOICE-12345.docx where `12345` is 5 random digit)
    - Attempted to connect to
        - URLs
        - IP
        - Ports
    - That have persistence mechanisms
    - Any other IOCs found

### Is it a False Positive?

If it's a False Positive:  
- Document and close the incident

If it's a True Positive:  
- Send communication to
    - Security Team
    - Admin Teams
    - Affected asset owners
    - Affected users
    - Managers, etc. according to Incident Response Plan
- Go to Analyze phase

</details>
</details>
</details>

## 3. Analyze
<details open>
<summary>Expand/Collapse</summary>

### Workflow
<details open>
<summary>Expand/Collapse</summary>

![Malware Analysis](https://github.com/marthajsosa/Incident-Response-Playbooks/blob/main/IR%20Malware/Workflows/Malware-Analysis-Workflow.drawio.png)

</details>

### Verify
<details open>
<summary>Expand/Collapse</summary>

In conjunction with a senior member of the SOC  
- Double check previous data
- Rule out False Positive

</details>

### Is this a Major/Critical Incident? --> Declare Major Incident
If this incident is deemed **Major or Critical** by the senior analyst follow the Critical Playbook (Coming soon).


### Identify IOCs
<details open>
<summary>Expand/Collapse</summary>

- Validate file hashes
    - [VirusTotal](https://www.virustotal.com/gui/home/upload)
    - [Hybrid Analysis](https://www.hybrid-analysis.com/)
- Validate links
    - [VirusTotal](https://www.virustotal.com/gui/home/upload)
    - [Hybrid Analysis](https://www.hybrid-analysis.com/)
    - [URLScan](https://urlscan.io/)

- ID other addresses, domains, IPs
    - [VirusTotal](https://www.virustotal.com/gui/home/upload)
    - [Hybrid Analysis](https://www.hybrid-analysis.com/)
    - [Talos Intelligence](https://talosintelligence.com/reputation_center)
    - [Domain Dossier](https://centralops.net/co/DomainDossier.aspx?)
      
- Search Threat Intel sources
    - [VirusTotal](https://www.virustotal.com/gui/home/upload)
    - [Hybrid Analysis](https://www.hybrid-analysis.com/)
    - [Talos Intelligence](https://talosintelligence.com/reputation_center)
- Disk forensics on endpoint (if required)

</details>


### Extract IOCs
<details open>
<summary>Expand/Collapse</summary>

#### Sandbox files and urls  
Collect the following informations:  
- Network connections 
- Registry modifications
- Files 
    - dropped
    - accessed
    - modified (renamed)
- Obfuscated/Deobfuscated script
    - From Script Block (for PowerShell)
- New services
    - Created
    - Launched
- New scheduled tasks
- New WMI provider(s)

</details>

### Submit Samples to Partners
<details open>
<summary>Expand/Collapse</summary>

If the malware was not detected/blocked by the security stack  
- Submit Samples to Security Vendor(s)
- Submit URLs, IP, Domains 

</details>

### Scan Enterprise
<details open>
<summary>Expand/Collapse</summary>

- Update AV / EDR 
    - Engine
    - Ruleset 
    - Policies
- Update FW, IDS, etc. rules with IOCs
- Search endpoints for IOCs with EDR
- Search SIEM for IOCs
- Search Firewall, Proxy, DNS logs for IOCs

</details>

### What Was Accessed
<details open>
<summary>Expand/Collapse</summary>

- Look for signs of lateral Movement
- Review firewall logs 
    - Network appliances
    - Endpoint (ie: Windows local firewall, EDR, AV, etc.)
- Review netflows

</details>

### Update Scope
<details open>
<summary>Expand/Collapse</summary>

- Update lists of
    - affected endpoints
    - affected company entities
    - affected clients

</details>

### Scope Validation
<details open>
<summary>Expand/Collapse</summary>

Have all the machines been identified? 
If you find further traces of infection or new IOCs go back to verify step. (coming soon)

When you are done identifying all compromised:  
- Hosts

And investigated all:  
- URLs
- Domains
- IP
- Ports
- Files
- Hash

</details>

### Do We Need External Help?
<details open>
<summary>Expand/Collapse</summary>

Evaluate if we need 
- Technical, Hands On, Response, etc. support 
- Legal counsel (data breach, lots of clients affected, etc.)

</details>

### Root Cause Analysis
<details open>
<summary>Expand/Collapse</summary>

What was initial access?
- Phish
- Drive by download
- Vulnerability
    - RCE
    - XSS
    - LFI
- Remote services
    - Default / Weak password
    - Brute Force
    - Vulnerability
- USB key/drive

</details>

### Determine Mitre ATT&CK Stage
<details open>
<summary>Expand/Collapse</summary>
The [Mitre ATT&CK Framework]() as various [Tactics] that are part of a [Cyber Kill Chain].  
It is important to know at which stage of the Kill Chain the attack was detected and stopped.  

Document your ticket with the following information:
- Stage of detection
- Stage of prevention
- Was action on objective completed?
    - File encrypted
    - Data exfiltrated
    - Account takeover, etc.
      
If data was exfiltrated go to the Data Loss Playbook (coming soon)

</details>

### Was Any Data Exfiltrated?
If we know or **suspect** that data was exfiltrated by the adversaries go to Data Loss Playbook (coming soon)

### Send communication
<details open>
<summary>Expand/Collapse</summary>

- Send a update communication to managers and teams as outlined in the communication portion of the Incident Response Plan

</details>

Go to the next phase <Contain/Eradicate>
</details>


## 4. Contain / Eradicate
<details open>
<summary>Expand/Collapse</summary>

### Workflow
<details open>
<summary>Expand/Collapse</summary>

![Malware Contain & Eradicate Workflow](https://github.com/marthajsosa/Incident-Response-Playbooks/blob/main/IR%20Malware/Workflows/Malware-Contain-Eradicate-Workflow.drawio.png)

</details>

### Does the host have EDR?
<details open>
<summary>Expand/Collapse</summary>

If the host **has** an EDR installed go to the [Contain Section](README.md#contain-affected-hosts)  
  
If the host **does not have** an EDR, is it possible to install one?  

Yes: 
- Install EDR
- Go to [Contain section](README.md#contain-affected-hosts)

No: Isolate / Unplug the host
- Apply one of the following containment strategy
    - Remove/shutdown virtual interface
    - Segment into "Dirty" VLAN
    - Shutdown switch port
- Go to [Action Taken section](README.md#action-taken-by-usercomputer)

</details>

### Contain Affected Hosts
<details open>
<summary>Expand/Collapse</summary>

- Update FW, Proxy, etc. rules
- Blackhole DNS
- Submit to Partners
    - AV/EDR Vendor
    - Web Filter Vendor
    - etc.

</details>

### Action Taken by User/Computer
<details open>
<summary>Expand/Collapse</summary>

Did the user: 
- Launch the malware
    - Open document(s)
    - Run the executable
    - Launch the script

Did the computer / EDR:
- Connect to external site(s)
- Write files to disk
- Modified registry keys
- New services
    - Created
    - Launched
- New scheduled tasks
- New WMI provider(s)
- Block excution
- Quarantine file(s)

</details>

### Admin Rights?
<details open>
<summary>Expand/Collapse</summary>

In order to select the right eradication strategy we need to know in which context the malware was executed.  

Was the user admin/root of the machine or any other machines in the environment?  
  
Yes:  
- Wipe physical machine
- Delete virtual machine

No:   
- Delete all IOCs
    - Files
    - Registry keys
    - Services
    - Scheduled Tasks
    - WMI provider(s), etc.

</details>

### Did Vendor Release New Signature?
<details open>
<summary>Expand/Collapse</summary>

Did the security vendor of the AV / EDR released a new engine, signature, policy to address the malware?  
  
No:  
- Go to [Close Monitoring](README.md#close-monitoring)  

Yes:  
- Upgrade security solution
- Update signatures
- Activate policy
- Scan systems enterprise wide 
    - Include customers if required

</details>

### Heightened Monitoring
<details open>
<summary>Expand/Collapse</summary>

- Monitor for: 
    - Internet connections to IOC
    - New files that match hashes identified
    - Processes
    - Behaviors that matched identified TTPs
    
</details>


### All Affected Endpoints Contained?
<details open>
<summary>Expand/Collapse</summary>

If all affected endpoints have been contained, you can go to the <Recover> phase, otherwise continue bellow.  

</details>

### New IOC Discovered?
<details open>
<summary>Expand/Collapse</summary>

If there was new IOC discovered, go back to the [Analyze Phase](README.md#3-analyze)  

Otherwise continue with [host containment](README.md#does-the-host-have-edr)
</details>
</details>

## 5. Recover
<details open>
<summary>Expand/Collapse</summary>

### Workflow
<details open>
<summary>Expand/Collapse</summary>

![Malware Recovery Workflow](https://github.com/marthajsosa/Incident-Response-Playbooks/blob/main/IR%20Malware/Workflows/Malware-Recover-Workflow.drawio.png)

</details>

### Rebuilt Systems
<details open>
<summary>Expand/Collapse</summary>

In an isolated environment:  
    - Install 
        - Supported OS
        - Security solutions
        - Fully patched applications
    - Restore data (from a clean backup)

</details>

### Vulnerability Scan
<details open>
<summary>Expand/Collapse</summary>

Perform:  
- External VA
- If possible
    - Authenticated scan
    - Agent base scan

</details>

### Patch Vulnerabilities
<details open>
<summary>Expand/Collapse</summary>

Any **Critical** or **High** vulnerability needs to be patched **before** the service is reestablish. 
This include, but it not limited to 
- Operating Systems
- Applications
- Network Appliances

Medium and Low vulnerability should be patched if possible, but should not be mandatory for restoring the service/lifting containment. 
</details>

### Update Defenses
<details open>
<summary>Expand/Collapse</summary>

Refine detection rules, note automation opportunities, and/or improve response procedures for the following:
- Firewall Rules
- EDR 
    - Blocked hashes
    - Blocked domains
    - Containment
- Proxy Block
- DNS Sinkhole, etc. 

</details>

### Restore Service
<details open>
<summary>Expand/Collapse</summary>

Depending on the containment applied to the host, perform all the following that applies:  
- Lift containment via EDR
- Move host to production VLAN
- Enable switch port
- Enable/Create virtual network interface
- etc. 

</details>

### All Affected Endpoints Restored?
<details open>
<summary>Expand/Collapse</summary>

If all affected endpoints have been restored, you can go to the <Post Incident> phase, otherwise continue bellow.  
- List systems that haven't been restored
- Go to [README.md#rebuild-systems]

</details>

### Validate Countermeasures
<details open>
<summary>Expand/Collapse</summary>

Determine if legitimate elements are blocked by:  
- AV / EDR
- IPS
- Proxy
- Firewall
- DNS
- Etc.

If so, apply the corrective action to restore functionality  

</details>

### Was Malware Known Before
<details open>
<summary>Expand/Collapse</summary>

If the malware was **not known** before the incident
- Validate with the proper security if you can submit the sample to 3rd parties like
    - VirusTotal
    - Hybrid-Analysis
    - Any.run
    - Threat Grid
    - Google Safe Browsing
    - OpenIOC
    - Industry security organizations (H-ISAC, E-ISAC, Auto-ISAC, etc.)

</details>

</details>

## 6. Post Incident
<details>
<summary>Expand/Collapse</summary>

### Workflow
<details open>
<summary>Expand/Collapse</summary>

![Malware Post-Incident Review](https://github.com/marthajsosa/Incident-Response-Playbooks/blob/main/IR%20Malware/Workflows/Malware-PostIncident-Review-Workflow.drawio.png)

</details>

### Incident Review
<details open>
<summary>Expand/Collapse</summary>

- What were the strengths? (internally to the overall security posture, detection, response, etc.)
- What were the weaknesses? (internally)
- What opportunities are there? (externally)
- What threats are there? (externally)

</details>

### Update Policies & Procedures
<details open>
<summary>Expand/Collapse</summary>

Update the following documents as required:  
- Policies
- Processes
- Procedures
- Playbooks
- Runbooks
- Automations

Update Detetion Rules in:  
- SIEM
- Malware Gataway
- AV / EDR
- IPS
- Other security tool

</details>

### Review Defensive Posture
<details open>
<summary>Expand/Collapse</summary>

- Schedule review of newly deployed rules in 6 months
- Are the following still applicatble
    - Firewall Rules
    - Proxy Rules for C2
    - AV / EDR custom Signatures
    - IPS Signatures, etc.

</details>

### Update & Upgrade Defenses
<details open>
<summary>Expand/Collapse</summary>

As we still have multiple AV & EDR Vendor, we must ensure **ALL** of them can detect this malware family in the future. Once the AV/EDR vendor confirms they can detect the sample we need to make sure:   
- Anti-Virus 
    - Signatures are updated for all
        - Company entities
        - Customers (globally)
    - Engine upgraded for all
        - Company entities
        - Customers (globally)
- EDR Rules
    - To detect the behaviors of the malware
- Email security tool
- Anti-Spam / Anti-Phish, etc.

</details>


### Build New Detections
<details open>
<summary>Expand/Collapse</summary>

SIEM Rules could be created to catch this type of behaviors and create tickets.

</details>

### Modifify Base Images
<details open>
<summary>Expand/Collapse</summary>

If the Malware Infection was caused by a lack of hardening or insufficient patch level: 
- Review hardening processes
- Include critical patches in base images
- Consider upgrading application
- Apply Security Patch to application, etc.

</details>

### User Awareness Training
<details open>
<summary>Expand/Collapse</summary>

If the incident was caused by a human error:
- Create / Select new mandatory training
    - From Security Education Vendor
    - Built by internal teams

</details>

### Calculate Incident's Cost
<details open>
<summary>Expand/Collapse</summary>


</details>

</details>

# References

This Playbook was built using the following references:  
https://www.gov.scot/publications/cyber-resilience-incident-management/  
https://sansorg.egnyte.com/dl/WFdH1hHnQI
https://github.com/certsocietegenerale/IRM/tree/master/EN   
https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf  
